<!doctype html>
<script type="module">
console.log("ABCD9");
import {alt_manifest_origin} from './../fedcm-helper.sub.js';

// Loading fedcm-iframe.html in the test will make a FedCM call on load, and
// trigger a postMessage upon completion.
//
// message {
//   string result: "Pass" | "Fail"
//   string token: token.token
//   string errorType: error.name
// }
window.onload = async () => {
  try {
  console.log("ABCD10");
   const manifest_path = `${alt_manifest_origin}/\
credential-management/support/fedcm/manifest.py`;
    const user_info = await IdentityProvider.getUserInfo({
      configURL: manifest_path,
      // Approved client
      clientId: '123',
    });
    let results = {
      result: "Pass",
      numAccounts: user_info.length,
      firstAccountEmail: ""
    };
    if (user_info.length > 0) {
      results.firstAccountEmail = user_info[0].email;
    }
    console.log(results);
    window.top.postMessage(results, '*');
  } catch (error) {
    console.log("Error");
    console.log(JSON.stringify(error));
    window.top.postMessage({result: "Fail", errorType: error.name}, '*');
  }
};

</script>

